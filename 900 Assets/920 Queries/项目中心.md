---
obsidianUIMode: preview
cssclasses:
  - fullwidth
type: query
tags:
  - favorite
---

## Active Projects
![[项目管理.base]]

```dataviewjs
// 获取项目数据
const pages = dv.pages('"100 Projects"')
    .where(p => p.start_date && p.due_date)
    .where(p => {
        const startMonth = dv.date(p.start_date).toFormat("yyyy-MM");
        const dueMonth = dv.date(p.due_date).toFormat("yyyy-MM");
        const currentMonth = dv.date("now").toFormat("yyyy-MM");
        return startMonth <= currentMonth && dueMonth >= currentMonth;
    })
    .sort(p => p.due_date, 'asc');

// 生成 Mermaid 甘特图代码
let mermaidCode = "```mermaid\ngantt\n";
mermaidCode += "    title 项目甘特图\n";
mermaidCode += "    dateFormat YYYY-MM-DD\n";
mermaidCode += "    axisFormat %y-%m\n\n";

// 按 context 分组（如果有的话）
const groupedPages = {};
pages.forEach(page => {
    const area = page.area || "默认项目";
    if (!groupedPages[area]) {
        groupedPages[area] = [];
    }
    groupedPages[area].push(page);
});

// 生成甘特图项目条目
Object.keys(groupedPages).forEach(context => {
    if (Object.keys(groupedPages).length > 1) {
        mermaidCode += `    section ${context}\n`;
    }
    
    groupedPages[context].forEach(page => {
        const taskName = page.file.name.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, ''); // 清理任务名称
        const startDate = dv.date(page.start_date).toFormat("yyyy-MM-dd");
        const dueDate = dv.date(page.due_date).toFormat("yyyy-MM-dd");
        
        // 状态映射
        let status = "";
        if (page.status === "completed") {
            status = "done, ";
        } else if (page.status === "active") {
            status = "active, ";
        }
        
        mermaidCode += `    ${page.file.name} :${status}${taskName}, ${startDate}, ${dueDate}\n`;
    });
    
    mermaidCode += "\n";
});

mermaidCode += "```";

// 显示生成的 Mermaid 代码
dv.paragraph(mermaidCode);
```

## Project Todos
```tasks
path includes 100 Projects
sort by path
not done
group by filename
sort by due
short mode
is not blocked
```
